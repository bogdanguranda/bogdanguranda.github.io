---
layout: base
---

<div class="blog-section">
    <div class="blog-content">
        <h1>{{ page.title }}</h1>
        {% if page.description and page.description != "" %}
        <p class="category-intro">{{ page.description }}</p>
        {% endif %}

        {% if page.toc %}
        <div class="toc">
            <h2>Explore</h2>
            <ul class="toc-list">
                {% for item in page.toc %}
                <li><a href="{{ item.url }}">{{ item.title }}</a></li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <!-- List blog posts in this section -->
        {% assign current_path = page.permalink | default: page.url %}
        {% assign all_blog_posts = site.pages | where: "layout", "blog-post" %}

        {% if page.show_all_posts %}
        {% assign posts = all_blog_posts | sort: "date" | reverse %}
        {% else %}
        {% assign posts = "" | split: "" %}
        {% for p in all_blog_posts %}
        {% if p.permalink contains current_path %}
        {% assign posts = posts | push: p %}
        {% endif %}
        {% endfor %}
        {% assign posts = posts | sort: "date" | reverse %}
        {% endif %}

        {% if posts.size > 0 %}
        <div class="blog-posts-list">
            <h2>Posts</h2>
            {% for post in posts %}
            <article class="blog-post-preview">
                <h3><a href="{{ post.url }}">{{ post.title }}</a></h3>
                {% if post.date %}
                <time class="post-date" datetime="{{ post.date | date_to_xmlschema }}">
                    {{ post.date | date: "%B %d, %Y" }}
                </time>
                {% endif %}
                {% if post.excerpt %}
                <p class="post-excerpt">{{ post.excerpt }}</p>
                {% endif %}
                {% if post.tags %}
                <div class="post-tags">
                    {% for tag in post.tags %}
                    <span class="tag clickable" data-tag="{{ tag }}">{{ tag }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </article>
            {% endfor %}
        </div>
        {% endif %}

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const urlParams = new URLSearchParams(window.location.search);
                let selectedTags = urlParams.get('tags') ? urlParams.get('tags').split(',').map(t => t.trim()) : [];

                function updateURL() {
                    const newParams = new URLSearchParams();
                    if (selectedTags.length > 0) {
                        newParams.set('tags', selectedTags.join(','));
                    }
                    const newURL = window.location.pathname + (newParams.toString() ? '?' + newParams.toString() : '');
                    window.history.replaceState(null, '', newURL);
                }

                function updateHeading() {
                    const heading = document.querySelector('.blog-posts-list h2');
                    if (selectedTags.length > 0) {
                        heading.textContent = 'Posts filtered by tags: ' + selectedTags.join(', ');
                    } else {
                        heading.textContent = 'Posts';
                    }
                }

                function filterPosts() {
                    const articles = document.querySelectorAll('.blog-post-preview');
                    articles.forEach(article => {
                        const postTags = Array.from(article.querySelectorAll('.tag')).map(el => el.textContent.trim());
                        const hasAllTags = selectedTags.every(tag => postTags.includes(tag));
                        article.style.display = hasAllTags || selectedTags.length === 0 ? '' : 'none';
                    });
                }

                function highlightTags() {
                    const allTags = document.querySelectorAll('.tag');
                    allTags.forEach(tagEl => {
                        const tagText = tagEl.textContent.trim();
                        if (selectedTags.includes(tagText)) {
                            tagEl.classList.add('selected');
                        } else {
                            tagEl.classList.remove('selected');
                        }
                    });
                }

                // Initial setup
                updateHeading();
                filterPosts();
                highlightTags();

                // Add click handlers
                const clickableTags = document.querySelectorAll('.clickable.tag');
                clickableTags.forEach(tagEl => {
                    tagEl.addEventListener('click', function () {
                        const tag = this.textContent.trim();
                        const index = selectedTags.indexOf(tag);
                        if (index > -1) {
                            selectedTags.splice(index, 1); // remove
                        } else {
                            selectedTags.push(tag); // add
                        }
                        updateURL();
                        updateHeading();
                        filterPosts();
                        highlightTags();
                    });
                });
            });
        </script>

        {% if content == "" or content == nil or content == blank %}
        {% unless posts.size > 0 or page.toc %}
        <p class="coming-soon">Sorry for the empty page, coming soon!</p>
        {% endunless %}
        {% else %}
        {{ content }}
        {% endif %}
    </div>

    {% include blog-sidebar.html %}

    <div class="back-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'});">Back to top ⬆️</div>
</div>
